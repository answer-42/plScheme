### Testing
use Test::More 'no_plan';

require('pispy.pl');

subtest 'Operators' => sub {
    is( pe("(- 4 5)"), '-1');
    is( pe("(* 5 5)"), '25' );
};

subtest 'Stuff' => sub {
    is( pe("(if (< 1  2) 3 4)"), '3');
    pe("(define x 0)");
    is( pe("(begin (set! x 5) (+ x 1))"), '6');
    is(pe("(set! x 9) x"), '9');
};

subtest 'Define functions' => sub {
    pe("(define fact (lambda (n) (if (= n 0) 1 (* n (fact (- n 1))))))");
    pe("(define fib (lambda (n) (if (< n 2) n (+ (fib (- n 1)) (fib (- n 2))))))");

    is( pe("(fact 3)"), '6', 'factorial 3');
    is( pe("(fib 1)"), '1', 'fibonacci 1');
    is( pe("(fib 3)"), '2', 'fibonacci 3');
    is( pe("(fib 10)"), '55', 'fibonacci 10');
};

subtest 'Operators 2' => sub {
  TODO: {
	local $TODO = 'Not yet implemented.';
	is(pe('(apply + (quote 1 2))'), '3','apply');
	is(pe('(car (quote 1 2 3 4))'),'1','car');
	is(pe('(apply + (cdr (quote 1 2 3)))'), '5', 'apply-cdr');
	is(pe('(length (quote 1 2 3 4))'), '4', 'length');

	ok( print pe('(append (quote 1 2) (quote 3 4))') eq '1234', 'append');
	ok( print pe('(cdr (quote 1 2 3 4))') eq '234', 'cdr');

    }
};
